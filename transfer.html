<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pay Naija - Transfer</title>
    <link rel='icon' href='img/PayNaija.png' type='image/x-icon' sizes="16x16" />
      <!-- Import Google font and icons -->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Work+Sans:400,700&display=swap" rel="stylesheet">
	  <link rel="stylesheet" href="bootstrap-4.5.0-dist/css/bootstrap.min.css">
      <link href="style.css" rel="stylesheet">
	  <link href="https://cdn.materialdesignicons.com/4.8.95/css/materialdesignicons.min.css" rel="stylesheet">
	  <link rel="stylesheet" href="iziToast-master/dist/css/iziToast.min.css">
</head>
<body>
    
    <!-- Navigation bar -->
    <div class="navigation-wrap bg-light start-header start-style">
		<div class="container">
			<div class="row">
				<div class="col-12">
					<nav class="navbar navbar-expand-md navbar-light">
					
						<a class="navbar-brand" href="home.html"><img src="img/PayNaija.png" alt="logo" width="100" height="50" /></a>	
						
						<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
							<span class="navbar-toggler-icon"></span>
						</button>
						
						<div class="collapse navbar-collapse" id="navbarSupportedContent">
							<ul class="navbar-nav ml-auto py-4 py-md-0">
								<li class="nav-item pl-4 pl-md-0 ml-0 ml-md-4">
									<a class="nav-link" href="home.html" role="button" aria-haspopup="true" aria-expanded="false">Home</a>
								</li>
								<li class="nav-item pl-4 pl-md-0 ml-0 ml-md-4 active">
									<a class="nav-link" href="transfer_amount.html">Transfer</a>
								</li>
								<li class="nav-item pl-4 pl-md-0 ml-0 ml-md-4">
									<a class="nav-link" href="contact.html">Contact</a>
								</li>
								<li class="nav-item pl-4 pl-md-0 ml-0 ml-md-4">
                                    <a class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" href="#" id="fullName">Hi, </a>
                                    <div class="dropdown-menu">
										<a class="dropdown-item" href="logout.html">Logout</a>
									</div>
								</li>
								<li class="nav-item pl-4 pl-md-0 ml-0 ml-md-4">
									<a class="nav-link" style="cursor: pointer;" onclick="markRead()">
                                        <span class="count" id="notifications-count"></span>
                                        <i class="mdi mdi-bell" style="font-size: 20px;"></i></a>
								</li>
							</ul>
						</div>
						
					</nav>		
				</div>
			</div>
        </div>

    </div>

    
        <!-- main page design layout -->
        <div class="container" style="margin-top: 100px;">

			<h5>Start a transaction by filling the recipient's details below.</h5>

			<form>
				<!-- first row -->
				<div class="row mt-4">
					<div class="col-sm-12 col-lg-8">
						<!-- first row -->
						<div class="row">
							<div class="col-sm-12 col-lg-6">
								<div class="form-group">
									<label for="firstName">First Name</label>
									<input type="text" class="form-control" id="firstName" required>
								  </div>
							</div>
							<div class="col-sm-12 col-lg-6">
								<div class="form-group">
									<label for="lastName">Last Name</label>
									<input type="text" class="form-control" id="lastName" required>
								  </div>
							</div>
						</div>
						<!-- second row -->
						<div class="row">
							<div class="col-sm-12 col-lg-6">
								<div class="form-group">
									<label for="middleName">Middle Name</label>
									<input type="text" class="form-control" id="middleName" required>
								  </div>
							</div>
							<div class="col-sm-12 col-lg-6">
								<div class="form-group">
									<label for="country">Country</label>
									<select class="form-control" id="country">
									 
									</select>
								  </div>
							</div>
						</div>

						<!-- third row -->
						<div class="row">
							<div class="col-sm-12 col-lg-6">
								<div class="form-group">
									<label for="state">State</label>
									<input type="text" class="form-control" id="state" required>
								</div>
							</div>
							<div class="col-sm-12 col-lg-6">
								<div class="form-group">
									<label for="zip">Zip Code</label>
									<input type="text" class="form-control" id="zip" required>
								  </div>
							</div>
						</div>

						<!-- fourth row -->
						<div class="row">
							<div class="col-sm-12 col-lg-6">
								<div class="form-group">
									<label for="phone">Phone No</label>
									<input type="text" class="form-control" id="phone" required>
								  </div>
							</div>
							<div class="col-sm-12 col-lg-6">
								<div class="form-group">
									<label for="address">Address</label>
									<input type="text" class="form-control" id="address" required>
								  </div>
							</div>
						</div>

						<!-- fifth row -->
						<div class="row">
							<div class="col-sm-12 col-lg-6">
								<div class="form-group">
									<label for="email">Email</label>
									<input type="email" class="form-control" id="email" required>
								  </div>
							</div>
							<div class="col-sm-12 col-lg-6">
								<div class="form-group">
									<label for="accountName">Account Name</label>
									<input type="text" class="form-control" id="accountName" required>
								  </div>
							</div>
						</div>

						<!-- sixth row -->
						<div class="row">
							<div class="col-sm-12 col-lg-6">
								<div class="form-group">
									<label for="accountNumber">Account Number</label>
									<input type="text" class="form-control" id="accountNumber" required>
								  </div>
							</div>
							<div class="col-sm-12 col-lg-6">
								<div class="form-group">
									<label for="bank">Bank Name</label>
									<input type="text" class="form-control" id="bank" required>
								  </div>
							</div>
						</div>


					</div>
					<div class="col-sm-12 col-lg-4">
						<div class="card mb-3">
							<div class="card-body">
								<h6 class="card-title text-center icon-color">Amount to Transfer (Naira)</h6>
								 <p class="card-text text-center mt-2 nairaAmount" style="font-size: 30px;">&#8358;</p>
							</div>
						  </div>
					</div>
				</div>
				

			

				<div class="mb-4">
					<button type="submit" class="btn btn-primary mt-2">Submit <span id="spinner"></span></button>
				</div>
				

			</form>
			   
		</div>
		
		 <!-- footer design -->
		 <footer style="background: #333333; padding-bottom: 20px;" class="mt-5">

			<div class="container pt-5">
				<div class="row">
					<div class="col-lg-4 col-sm-12">
						<h6 style="color: white;">Our Information</h6>
						<p style="color: white; font-size: 13px;" >7321 N Paulina St, Chicago, IL. 60626.</p>
					</div>
	
					<div class="col-lg-4 col-sm-12">
							<h6 style="color: white;">Our Correspondence</h6>
							<p style="color: white; font-size: 13px;">+1 (312) 774-9047</p>
					</div>
					<div class="col-lg-4 col-sm-12">
							<h6 style="color: white;">Connect with us.</h6>
							<ul style="display: flex; list-style: none;">
								<li><a href="#" style="color: white;"><i class="fab fa-twitter"></i></a></li>
								<li style="margin-left: 20px;"><a href="#" style="color: white;"><i class="fab fa-facebook"></i></a></li>
								<li style="margin-left: 20px;"><a href="#" style="color: white;"><i class="fab fa-instagram"></i></a></li>
								<li style="margin-left: 20px;"><a href="mailto:seyiekundayo879@gmail.com" style="color: white;"><i class="mdi mdi-email"></i></a></li>
							</ul>
					</div>
				</div>
			</div>
			
			<div class="container mt-3">
				<p style="color: white; font-size: 14px;">&copy; PayNaija 2020. All rights reserved.</p>
			</div>
		</footer>

      
    







<script src="dist/jquery.min.js"></script>
<script src="bootstrap-4.5.0-dist/js/bootstrap.min.js"></script>
<script src="lib/viewdata.js"></script>
<script src="lib/jquery.cookie.js"></script>
<script src="https://kit.fontawesome.com/d54c227c34.js"></script>
	<!-- Forms Validations Plugin -->
<script src="/assets/js/plugins/jquery.validate.min.js"></script>
<script src="iziToast-master/dist/js/iziToast.min.js"></script>
  <script>
    $(document).ready(function(){

		var view_data = new ViewData();
		var fullName = view_data.getStoredUserDetail('fullName');
		var token = view_data.getStoredUserDetail("token"); 

        $('#fullName').append(fullName)

		  // to get the query string parameters from the url
		  var nairaValue;
        var dollarValue;
        var query = window.location.search.substring(1);
        var parms = query.split('&');
        parms.forEach(function(e) {
            var keyValue = e.split("=");
            var key = keyValue[0];
            var value = keyValue[1];
            if(key === 'naira-amount') {
                // console.log(value);
                nairaValue = value;
            }
            else if(key === 'dollar-amount'){
                // console.log(value);
            dollarValue = value
            }
		})

		console.log(nairaValue)
		console.log(dollarValue)

		$('.nairaAmount').append(nairaValue)
        


		$('body').on('mouseenter mouseleave','.nav-item',function(e){
			if ($(window).width() > 750) {
				var _d=$(e.target).closest('.nav-item');_d.addClass('show');
				setTimeout(function(){
				_d[_d.is(':hover')?'addClass':'removeClass']('show');
				},1);
			}
		});
		
		  // Generic dashboard details
		  var notification = "notification";
          var notificationsUrl = view_data.ControllerRouteURL + notification;
        $.ajax({
                url: notificationsUrl,
                type: "GET",
                dataType: 'json',
                data: false,
                contentType: false,
                      cache: false,
                processData:false,
                beforeSend : function(jqXHR, settings)
                {
                  jqXHR.setRequestHeader('Authorization',token);
                },
                success: function(data)
                {
                    console.log(data);
                    var length = data.unReadLength
                    $('#notifications-count').text(length)
                   
                },
                complete: function(jqXHR){
                      if(jqXHR.status == '401'){
                        alert("Session expired, Kindly login again to continue");
                        window.location.replace("logout.html");
                          }
                  } 
          })


		// Api request to get all countries
		var view_data = new ViewData();
        var countryUrl = view_data.CountriesURL;

      $.ajax({
                url: countryUrl,
                type: "GET",
                dataType: 'json',
                data: false,
                contentType: false,
                      cache: false,
                processData:false,
                beforeSend : function(jqXHR, settings)
                {

                },
                success: function(data)
                {
					var country = data.data
					console.log(country)
					for(var i in country){
					var myCountry = country[i]['country']; //alerts key's value
					$("select#country").append("<option value='"+myCountry+"'>"+myCountry+"</option>");
					}
                },
                complete: function(jqXHR){
					if (jqXHR.status != '200') {
                      var obj = $.parseJSON(jqXHR.responseText);
                  	 }
                 }  
          })
		
		// on form submit
        $("form").submit(function(event) {
			event.preventDefault()

			var view_data = new ViewData();
         	 var send_function = "payment";
			var url = view_data.ControllerRouteURL + send_function;
			var token = view_data.getStoredUserDetail("token");

          var fName = $("#firstName").val();
          var lName = $("#lastName").val();
          var mName = $('#middleName').val();
          var country = $('select#country option:selected').val();
          var state = $('#state').val();
          var stateZipCode = $('#zip').val();
          var phoneNo = $('#phone').val();
          var address = $('#address').val();
          var email = $('#email').val();
          var accountNumber = $('#accountNumber').val();
          var accountName = $('#accountName').val();
          var bankName = $('#bank').val();
         

          var data = {
            fName: fName,
            lName: lName,
            mName: mName,
            country: country,
			state: state,
			stateZipCode: stateZipCode,
			phoneNo: phoneNo,
			address: address,
			email: email,
			accountNumber: accountNumber,
			accountName: accountName,
			bankName: bankName,
			amountNaira: nairaValue,
			amountDollar: dollarValue
          }

          $.ajax({
                type: 'POST',
                data: JSON.stringify(data),
                url: url,
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
              beforeSend: function(jqXHR, settings) {
				jqXHR.setRequestHeader('Authorization',token);
                  $('#spinner').addClass("fa fa-circle-o-notch fa-spin");
              },
              success: function(data) {
                console.log(data)
                iziToast.success({
                    message: 'Successful, Kindly contact the admin to Proceed with your payments',
                    progressBar: false,
                    position: 'topRight'
                });

                $("#firstName").val('');
				$("#lastName").val('');
				$('#middleName').val('');
				$('#state').val('');
				$('#zip').val('');
				$('#phone').val('');
				$('#address').val('');
				$('#email').val('');
				$('#accountNumber').val('');
				$('#accountName').val('');
				$('#bank').val('');

              },
              error: function(data){
                  $('#spinner').removeClass("fa fa-circle-o-notch fa-spin");  
                  iziToast.error({
                    message: 'Invalid Input',
                    progressBar: false,
                    position: 'topRight'
                });

              },
              complete: function(jqXHR) {
				if(jqXHR.status == '401'){
                        alert("Session expired! Please login again.");
                        window.location.replace("logout.html");
                     }
                  $('#spinner').removeClass("fa fa-circle-o-notch fa-spin");
              }
          })
			
		})
		
	})  
	
	function markRead(){
        var view_data = new ViewData();
        var token = view_data.getStoredUserDetail("token"); 

        var count = parseInt($('#notifications-count').text())
        console.log(count)

        if(count === 0){
            window.location.replace("notifications.html"); 
        }else{
            var read = "markread";
            var readUrl = view_data.ControllerRouteURL + read;
            $.ajax({
                    url: readUrl,
                    type: "POST",
                    dataType: 'json',
                    data: false,
                    contentType: false,
                        cache: false,
                    processData:false,
                    beforeSend : function(jqXHR, settings)
                    {
                    jqXHR.setRequestHeader('Authorization',token);
                    },
                    success: function(data)
                    {
                        console.log(data);
                        window.location.replace("notifications.html");
                    },
                    complete: function(jqXHR){
                        if(jqXHR.status == '401'){
                            alert("Session expired, Kindly login again to continue");
                            window.location.replace("logout.html");
                            }
                    } 
            })
        }
         
    }
  </script> 
</body>
</html>